# 🏗️ สถาปัตยกรรมระบบ Mooprompt Restaurant

## 📊 ภาพรวมระบบ

ระบบแยกหน้าที่การทำงานตาม **Role** ของผู้ใช้ แต่ละ role จะเห็นหน้าและฟีเจอร์ที่แตกต่างกัน

---

## 👥 User Roles & Access Control

### 1. **ADMIN** (ผู้ดูแลระบบ)
- **หน้าที่:** จัดการระบบทั้งหมด
- **เข้าถึงได้:**
  - ✅ ทุกหน้า Admin (`/admin/*`)
  - ✅ หน้า Kitchen (`/kitchen`)
  - ✅ หน้า Runner (`/runner`)
- **UI:** Sidebar + Topbar พร้อมเมนูครบ

### 2. **MANAGER** (ผู้จัดการ)
- **หน้าที่:** จัดการร้าน (คล้าย Admin แต่จำกัดบางส่วน)
- **เข้าถึงได้:**
  - ✅ ทุกหน้า Admin (`/admin/*`)
  - ✅ หน้า Kitchen (`/kitchen`)
  - ✅ หน้า Runner (`/runner`)
- **UI:** Sidebar + Topbar เหมือน Admin

### 3. **CASHIER** (แคชเชียร์)
- **หน้าที่:** เปิด/ปิดโต๊ะ, ปิดบิล
- **เข้าถึงได้:**
  - ✅ ทุกหน้า Admin (`/admin/*`)
  - ❌ ไม่ได้เข้าหน้า Kitchen
  - ❌ ไม่ได้เข้าหน้า Runner
- **UI:** Sidebar + Topbar เหมือน Admin

### 4. **KITCHEN** (ครัว)
- **หน้าที่:** ดูออเดอร์, เปลี่ยนสถานะ (COOKING/DONE)
- **เข้าถึงได้:**
  - ✅ หน้า Kitchen เท่านั้น (`/kitchen`)
  - ❌ ไม่ได้เข้าหน้า Admin
  - ❌ ไม่ได้เข้าหน้า Runner
- **UI:** หน้าเดียว ไม่มี Sidebar

### 5. **RUNNER** (พนักงานเสิร์ฟ)
- **หน้าที่:** ดูออเดอร์ที่พร้อมเสิร์ฟ, กด SERVED
- **เข้าถึงได้:**
  - ✅ หน้า Runner เท่านั้น (`/runner`)
  - ❌ ไม่ได้เข้าหน้า Admin
  - ❌ ไม่ได้เข้าหน้า Kitchen
- **UI:** หน้าเดียว ไม่มี Sidebar

### 6. **STAFF** (พนักงานทั่วไป)
- **หน้าที่:** ยังไม่ได้กำหนด (reserved)
- **เข้าถึงได้:** ยังไม่มี

---

## 🔐 การตรวจสอบสิทธิ์ (Authorization)

### 1. **Client-side Check** (ในแต่ละหน้า)

```typescript
// หน้า Kitchen
if (!currentUser || (currentUser.role !== 'KITCHEN' && currentUser.role !== 'ADMIN')) {
  router.push('/login')
  return
}

// หน้า Runner
if (!currentUser || (currentUser.role !== 'RUNNER' && currentUser.role !== 'ADMIN')) {
  router.push('/login')
  return
}

// หน้า Admin
const allowedRoles = ['ADMIN', 'MANAGER', 'CASHIER']
if (!allowedRoles.includes(user.role)) {
  router.push('/login')
  return
}
```

### 2. **Middleware** (Server-side)
- ปัจจุบันยังเป็น placeholder
- ควรเพิ่ม JWT verification ในอนาคต

---

## 📱 หน้าจอของแต่ละ Role

### 🍳 **KITCHEN** - `/kitchen`

```
┌─────────────────────────────────────┐
│  🍳 ครัว          [🌐] [ออก]        │
├─────────────────────────────────────┤
│                                     │
│  📋 ออเดอร์ #1 - โต๊ะที่ 5         │
│  ⏰ 12:30:45                        │
│  ────────────────────────────────  │
│  ⏳ หมูสไลด์ x 2                    │
│      [กำลังทำ]                      │
│                                     │
│  ✅ เนื้อสไลด์ x 1                  │
│      [พร้อมเสิร์ฟ]                  │
│                                     │
└─────────────────────────────────────┘
```

**ฟีเจอร์:**
- ดูออเดอร์ที่ status = WAITING, COOKING, DONE
- กด "กำลังทำ" → เปลี่ยนเป็น COOKING
- กด "พร้อมเสิร์ฟ" → เปลี่ยนเป็น DONE
- Real-time update ผ่าน Socket.IO

---

### 🏃 **RUNNER** - `/runner`

```
┌─────────────────────────────────────┐
│  🧾 พนักงานเสิร์ฟ  [🌐] [ออก]      │
├─────────────────────────────────────┤
│                                     │
│  📋 ออเดอร์ #1 - โต๊ะที่ 5         │
│  ⏰ 12:30:45                        │
│  ────────────────────────────────  │
│  ✅ เนื้อสไลด์ x 1                 │
│      [เสิร์ฟแล้ว]                   │
│                                     │
└─────────────────────────────────────┘
```

**ฟีเจอร์:**
- ดูออเดอร์ที่ status = DONE เท่านั้น
- กด "เสิร์ฟแล้ว" → เปลี่ยนเป็น SERVED
- Real-time update เมื่อครัวเปลี่ยนเป็น DONE

---

### 👨‍💼 **ADMIN/MANAGER/CASHIER** - `/admin/*`

```
┌─────────────────────────────────────────────┐
│  Mooprompt Restaurant  [🌙] [🌐] [ออก]     │
├──────────┬───────────────────────────────────┤
│          │                                   │
│ 📋 เมนู  │  จัดการเมนู                      │
│ 📁 หมวด  │                                   │
│ 🪑 โต๊ะ  │  [เพิ่มเมนู]                      │
│ 📦 แพ็ก  │                                   │
│ 💰 ค่า   │  ┌─────────┐ ┌─────────┐        │
│ 🏷️ โปร   │  │ หมูสไลด์ │ │ เนื้อสไลด์ │        │
│ ⚙️ ตั้ง   │  │ ฿150    │ │ ฿250    │        │
│ 👥 ผู้ใช้ │  └─────────┘ └─────────┘        │
│          │                                   │
└──────────┴───────────────────────────────────┘
```

**ฟีเจอร์:**
- จัดการเมนู, หมวดหมู่, โต๊ะ
- เปิด/ปิดโต๊ะ
- จัดการแพ็กเกจ, ค่าบริการ, โปรโมชั่น
- จัดการผู้ใช้
- ตั้งค่าร้าน

---

## 🔄 Flow การทำงาน

### 1. **ลูกค้าสั่งอาหาร**
```
ลูกค้า → สแกน QR → /session/[id] → /menu → /cart → สั่งอาหาร
                                              ↓
                                    POST /api/order/create
                                              ↓
                                    Socket.IO: order:new
```

### 2. **ครัวเห็นออเดอร์**
```
Socket.IO: order:new → /kitchen → ดูออเดอร์ใหม่
                              ↓
                    กด "กำลังทำ" → COOKING
                              ↓
                    กด "พร้อมเสิร์ฟ" → DONE
                              ↓
                    Socket.IO: order:done
```

### 3. **พนักงานเสิร์ฟเห็นออเดอร์**
```
Socket.IO: order:done → /runner → ดูออเดอร์ DONE
                                  ↓
                        กด "เสิร์ฟแล้ว" → SERVED
                                  ↓
                        Socket.IO: order:served
```

### 4. **แคชเชียร์ปิดโต๊ะ**
```
Admin/Cashier → /admin/close-table → เลือกโต๊ะ
                                    ↓
                          POST /api/billing/close
                                    ↓
                          คำนวณยอด → สร้างใบเสร็จ
```

---

## 🎯 สรุป: แต่ละ Role เห็นหน้าเดียวกันไหม?

### ❌ **ไม่เห็นหน้าเดียวกัน**

แต่ละ Role จะเห็นหน้าและฟีเจอร์ที่แตกต่างกัน:

| Role | หน้า Admin | หน้า Kitchen | หน้า Runner |
|------|-----------|-------------|------------|
| **ADMIN** | ✅ | ✅ | ✅ |
| **MANAGER** | ✅ | ✅ | ✅ |
| **CASHIER** | ✅ | ❌ | ❌ |
| **KITCHEN** | ❌ | ✅ | ❌ |
| **RUNNER** | ❌ | ❌ | ✅ |

### 🔒 **การป้องกัน**
- แต่ละหน้าจะตรวจสอบ role ก่อนแสดง
- ถ้าไม่มีสิทธิ์ → redirect ไป `/login`
- ADMIN สามารถเข้าทุกหน้าได้

---

## 💡 ข้อดีของการแยกหน้า

1. **ความปลอดภัย** - แต่ละ role เห็นเฉพาะสิ่งที่ต้องทำ
2. **UX ดี** - ไม่สับสน, UI ตรงกับหน้าที่
3. **Performance** - โหลดเฉพาะข้อมูลที่จำเป็น
4. **ง่ายต่อการดูแล** - แยก logic ชัดเจน

---

## 🚀 การพัฒนาต่อ

### Phase 1: ปรับปรุง Authorization
- [ ] เพิ่ม JWT token verification
- [ ] Server-side middleware ที่แข็งแรง
- [ ] API route protection

### Phase 2: Dashboard
- [ ] สร้าง dashboard สำหรับแต่ละ role
- [ ] แสดงสถิติที่เกี่ยวข้อง

### Phase 3: Notification
- [ ] Push notification เมื่อมีออเดอร์ใหม่
- [ ] Sound alert สำหรับครัว

---

**หมายเหตุ:** ระบบปัจจุบันใช้ client-side check เป็นหลัก ควรเพิ่ม server-side validation ในอนาคต

